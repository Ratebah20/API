{% extends "base.html" %}

{% block content %}
<div class="bg-white rounded-lg shadow-md p-6">
    <h1 class="text-3xl font-bold text-orange-600 mb-6">{{ _("Simulateur d'√©crans mobiles") }}</h1>
    
    <div class="mb-8">
        <p class="text-gray-700 mb-4">
            {{ _("Ce simulateur vous permet de visualiser l'exp√©rience utilisateur sur mobile pour les diff√©rentes fonctionnalit√©s de l'API Orange Travel B2B. Choisissez un sc√©nario pour voir la simulation.") }}
        </p>
    </div>
    
    <div x-data="simulator" class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <!-- D√©bogage pour v√©rifier les valeurs -->
        <div style="display: none;" x-init="console.log('x-data initialis√© avec simulator')"></div>
        <div class="flex flex-col">
            <!-- S√©lection des sc√©narios -->
            <div class="bg-orange-50 rounded-lg p-4 mb-4">
                <h3 class="text-lg font-semibold text-orange-700 mb-3">{{ _("Sc√©narios disponibles") }}</h3>
                <ul class="space-y-2">
                    <li>
                        <button 
                            @click="switchFlow('purchase', 'start')" 
                            :class="currentFlow === 'purchase' ? 'bg-orange-500 text-white' : 'bg-white text-orange-500 border border-orange-500'" 
                            class="w-full py-2 px-4 rounded transition">
                            {{ _("Achat et activation d'eSIM") }}
                        </button>
                    </li>
                    <li>
                        <button 
                            @click="switchFlow('management', 'receive_profile')" 
                            :class="currentFlow === 'management' ? 'bg-orange-500 text-white' : 'bg-white text-orange-500 border border-orange-500'" 
                            class="w-full py-2 px-4 rounded transition">
                            {{ _("Gestion de l'eSIM") }}
                        </button>
                    </li>
                </ul>
            </div>
            
            <!-- Section d'informations API -->
            <div class="bg-blue-50 rounded-lg p-4">
                <h3 class="text-lg font-semibold text-blue-700 mb-3">{{ _("Endpoint API") }}</h3>
                <div class="api-reference" x-show="currentFlow === 'purchase'">
                    <div x-show="currentStep === 'start'">
                        <p class="text-blue-800 font-mono text-sm">{{ _("Aucun appel API √† cette √©tape") }}</p>
                        <p class="text-sm mt-2">{{ _("Initialisation de l'application.") }}</p>
                    </div>
                    <div x-show="currentStep === 'access_travel'">
                        <p class="text-blue-800 font-mono text-sm">POST /oauth/v3/token</p>
                        <p class="text-sm mt-2">{{ _("Authentification et obtention du token d'acc√®s.") }}</p>
                    </div>
                    <div x-show="currentStep === 'list_countries'">
                        <p class="text-blue-800 font-mono text-sm">GET /distributors/offers</p>
                        <p class="text-sm mt-2">{{ _("R√©cup√©ration des offres disponibles, filtr√©es par pays.") }}</p>
                    </div>
                    <div x-show="currentStep === 'select_country'">
                        <p class="text-blue-800 font-mono text-sm">{{ _("Manipulation c√¥t√© client") }}</p>
                        <p class="text-sm mt-2">{{ _("Aucun appel API, filtrage des donn√©es d√©j√† re√ßues.") }}</p>
                    </div>
                    <div x-show="currentStep === 'select_offer'">
                        <p class="text-blue-800 font-mono text-sm">GET /distributors/offers/{offer_id}</p>
                        <p class="text-sm mt-2">{{ _("R√©cup√©ration des d√©tails de l'offre s√©lectionn√©e.") }}</p>
                    </div>
                    <div x-show="currentStep === 'receive_esim'">
                        <p class="text-blue-800 font-mono text-sm">POST /distributors/transactions</p>
                        <p class="text-sm mt-2">{{ _("Cr√©ation d'une transaction pour obtenir une eSIM.") }}</p>
                    </div>
                    <div x-show="currentStep === 'decrypt_esim'">
                        <p class="text-blue-800 font-mono text-sm">{{ _("Utilisation de la cl√© priv√©e") }}</p>
                        <p class="text-sm mt-2">{{ _("D√©chiffrement du code d'activation √† l'aide de la cl√© priv√©e du distributeur.") }}</p>
                    </div>
                    <div x-show="currentStep === 'install_esim'">
                        <p class="text-blue-800 font-mono text-sm">{{ _("Redirection syst√®me") }}</p>
                        <p class="text-sm mt-2">{{ _("Redirection vers les param√®tres du t√©l√©phone pour installer le profil eSIM.") }}</p>
                    </div>
                    <div x-show="currentStep === 'activate_esim'">
                        <p class="text-blue-800 font-mono text-sm">{{ _("Op√©ration syst√®me") }}</p>
                        <p class="text-sm mt-2">{{ _("Activation du profil eSIM install√© sur l'appareil.") }}</p>
                    </div>
                </div>
                
                <div class="api-reference" x-show="currentFlow === 'management'">
                    <div x-show="currentStep === 'receive_profile'">
                        <p class="text-blue-800 font-mono text-sm">{{ _("Affichage des d√©tails de l'eSIM") }}</p>
                        <p class="text-sm mt-2">{{ _("Informations sur le profil eSIM d√©j√† install√©.") }}</p>
                    </div>
                    <div x-show="currentStep === 'my_esim'">
                        <p class="text-blue-800 font-mono text-sm">{{ _("Navigation interne") }}</p>
                        <p class="text-sm mt-2">{{ _("Acc√®s √† la section de gestion des eSIM.") }}</p>
                    </div>
                    <div x-show="currentStep === 'supplier_info'">
                        <p class="text-blue-800 font-mono text-sm">GET /distributors/suppliers/{supplier_id}</p>
                        <p class="text-sm mt-2">{{ _("R√©cup√©ration des informations sur le fournisseur de l'eSIM.") }}</p>
                    </div>
                    <div x-show="currentStep === 'esim_type'">
                        <p class="text-blue-800 font-mono text-sm">{{ _("Affichage des propri√©t√©s") }}</p>
                        <p class="text-sm mt-2">{{ _("Affichage des caract√©ristiques sp√©cifiques de l'eSIM.") }}</p>
                    </div>
                    <div x-show="currentStep === 'msisdn_info'">
                        <p class="text-blue-800 font-mono text-sm">GET /distributors/suppliers/{supplier_id}/sims/{sim_id}</p>
                        <p class="text-sm mt-2">{{ _("R√©cup√©ration du num√©ro MSISDN associ√© √† l'eSIM, si disponible.") }}</p>
                    </div>
                    <div x-show="currentStep === 'usage_info'">
                        <p class="text-blue-800 font-mono text-sm">GET /distributors/suppliers/{supplier_id}/usagebalances</p>
                        <p class="text-sm mt-2">{{ _("R√©cup√©ration des informations de consommation pour l'eSIM.") }}</p>
                    </div>
                </div>
            </div>

        <!-- Partie de l'√©cran mobile pour la simulation -->
        <div class="md:col-span-2">
            <!-- Simulateur d'√©cran mobile -->
            <div class="border-4 border-gray-800 rounded-3xl p-2 mx-auto max-w-xs h-[600px] bg-white shadow-lg relative">
                <!-- Barre de statut -->
                <div class="bg-gray-800 text-white text-xs p-1 flex justify-between">
                    <span>9:41</span>
                    <div class="flex space-x-1">
                        <span>üì∂</span>
                        <span>üîã</span>
                    </div>
                </div>
                
                <!-- Contenu de l'√©cran avec les diff√©rents flux -->
                <div class="bg-orange-50 h-[550px] overflow-y-auto p-4">
                    <!-- Inclusion du flux d'achat d'eSIM -->
                    {% include 'purchase_flow.html' %}
                    
                    <!-- Inclusion du flux de gestion d'eSIM -->
                    {% include 'management_flow.html' %}
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<!-- Chargement d'Alpine.js -->
<script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.12.0/dist/cdn.min.js"></script>

<!-- Configuration Alpine.js AVANT l'attribut defer -->
<script>
    console.log('D√©but de la configuration Alpine.js');
    
    // IMPORTANT: Dans Alpine.js v3, la mani√®re recommand√©e est d'utiliser Alpine.data
    document.addEventListener('alpine:init', () => {
        console.log('√âv√©nement alpine:init d√©clench√©');
        
        Alpine.data('simulator', () => ({
            currentFlow: 'purchase',
            currentStep: 'start',
            previousSteps: [],
            
            init() {
                console.log('Composant simulator initialis√©');
            },
            
            goToStep(step) {
                console.log('goToStep appel√© avec step:', step);
                this.previousSteps.push(this.currentStep);
                this.currentStep = step;
                console.log('√âtape actuelle chang√©e vers:', this.currentStep);
            },
            
            goBack() {
                console.log('goBack appel√©');
                if (this.previousSteps.length > 0) {
                    this.currentStep = this.previousSteps.pop();
                    console.log('Retour √† l\'√©tape:', this.currentStep);
                }
            },
            
            switchFlow(flow, initialStep) {
                console.log('switchFlow appel√©:', flow, initialStep);
                this.currentFlow = flow;
                this.currentStep = initialStep;
                this.previousSteps = [];
                console.log('Flux chang√© vers:', this.currentFlow);
            }
        }));
    });
    
    console.log('Configuration Alpine.js termin√©e');
</script>
{% endblock %}
